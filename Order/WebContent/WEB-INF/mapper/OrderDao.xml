<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 필수 : interface의 full name으로 설정 -->
<mapper namespace="com.wifi.order.dao.OrderDao">
	
	<!-- in item page  =======================================-->
	
	<!-- 잔여 참여인원 확인 -->
	<select id="checkRemain" resultType="int">
		select count(*) from wifi.order where iidx=#{iidx} and state=0
	</select>
	
	<!-- 20.08.21 박혜미 수정 : 내 판매글인지 확인 추가. -->
	<!-- 내 판매글인지 확인 -->
	<select id="checkSeller" resultType="int">
		select count(*) from wifi.item where midx=#{param1} and iidx=#{param2}
	</select>

	<!-- 참여신청 -->
	<insert id="regOrder">
		insert into wifi.order (midx, iidx) values(#{param1}, #{param2})
	</insert>

	
	<!-- aside 공구참여현황 =======================================-->

	<!-- 참여중인 주문글 리스트 -->
	<select id="getOrderList" resultType="com.wifi.order.model.MyOrder">
		select midx, iidx, ostate, title, ifnull(pstate, 3) as pstate from wifi.myorder where midx=#{midx}
	</select>


	<!-- 참여자 중복확인 -->
	<select id="checkDouble" resultType="int">
		select count(*) from wifi.order where midx=#{param1} and iidx=#{param2} and state == 0    
	</select>
	
	
	<!-- 참여신청 취소 처리 -->
	<delete id="delOrder"> 
		delete from wifi.order where midx=#{param1} and iidx=#{param2} 
	</delete>
	
	
	<!-- 구매자의 판매자 평점등록 -->
	<insert id="regRvs" parameterType="com.wifi.order.model.ItemRvs">  
		insert into wifi.item_rvs (score_s, midx, iidx) values(#{score_s}, #{midx}, #{iidx})  
	</insert>
	
	
	<!-- oidx 검색 -->
	<select id="getOidx" resultType="int"> 
		select oidx from wifi.order where midx=#{param1} and iidx=#{param2}
	</select>




</mapper>






